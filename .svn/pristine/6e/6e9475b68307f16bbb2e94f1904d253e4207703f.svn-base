<script type='text/javascript'>    jQuery(function() {		var curr_date = '<?=date("Y/m/d"); ?>';		jQuery('[id^=txt_from_date_]').datepicker({minDate: curr_date,dateFormat: 'yy/mm/dd'});			jQuery('[id^=txt_to_date_]').datepicker({minDate: curr_date,dateFormat: 'yy/mm/dd'});	    });	function get_head_val(vals){		is_checked = jQuery("#chk_all_head").is(':checked');		if(is_checked){			jQuery(":checkbox").attr("checked", true);		}else{			jQuery(":checkbox").attr("checked", false);		}	}		function hide_select_all(){		jQuery('#chk_all_head').attr("checked", false);		jQuery('#chk_all_foot').attr("checked", false);	}		function get_foot_val(vals){		is_checked = jQuery("#chk_all_foot").is(':checked');		if(is_checked){			jQuery(":checkbox").attr("checked", true);		}else{			jQuery(":checkbox").attr("checked", false);		}	}		function operation_ids(){		var count_val=0;		var index=0;		var val_id="";		var from_date = "";		var to_date = "";		var status = "";		jQuery('input[name="chk_user[]"]').each( function() {				if(jQuery(this).is(':checked')){					count_val++;				}		});		if(count_val==0){			alert("Select record(s) to set the status of the user");			return false;		}else{			jQuery('input[name="chk_user[]"]').each(function() {				if(jQuery(this).is(':checked')){					val_id += jQuery(this).val()+",";					from_date +=jQuery('#txt_from_date_'+index).val()+","; 					to_date +=jQuery('#txt_to_date_'+index).val()+","; 					status +=jQuery('#set_user_status_'+index).val()+","; 				}				index++;			});			val_id = val_id.slice(0, -1);			from_date = from_date.slice(0, -1);			to_date = to_date.slice(0, -1);			status = status.slice(0, -1);			var url_val = jQuery('#site_url').val();						jQuery.post(url_val+"save_to_db.php", { user_id: val_id, from_date: from_date, to_date: to_date, status: status },function(data) {				if(data=="yes"){					alert("Setting Saved Successfully");				}else{					alert("Setting Saved Successfully");				}			});						return false;		}	}</script><center><h2>User Status Manager</h2></center><hr/><?php global  $wpdb; $table = $wpdb->prefix . 'user_status_manager'; // 'orderby' => 'registered', 'order' => 'ASC'  //$blogusers = get_users(); $args = fnSetArgument();  $strMessageTable = $wpdb->prefix . 'usm_post_message'; $arrMessageId = $wpdb->get_results("select id,post_message from $strMessageTable LIMIT 1");   $blogusers = new WP_User_Query( $args ); $arrUserDetails = $blogusers->get_results(); $intUserCount = count($arrUserDetails);  /* // count the number of users found in the query echo $total_users = $arrUserDetails ? count($arrUserDetails) : 1;	 // grab the current page number and set to 1 if no page number is set $page = isset($_GET['p']) ? $_GET['p'] : 1;	 // how many users to show per page $users_per_page = 2;	 // calculate the total number of pages. $total_pages = 1; $offset = $users_per_page * ($page - 1); echo $total_pages = ceil($total_users / $users_per_page);  if($total_pages==1){ 	$arrArgs = fnSetArgument(); } else{ 	$arrArgs = fnSetArgument($offset); } $arrUserTemp = new WP_User_Query($arrArgs); $arrUsers = $arrUserTemp->get_results(); */ if(isset($_POST['strPostMessage']) && !empty($_POST['strPostMessage'])){	$wpdb->update($strMessageTable,array('post_message'=>$_POST['strPostMessage']),array('id'=>$arrMessageId[0]->id));	$strPostMessage = $_POST['strPostMessage'];	echo "<script>alert('Message Saved Successfully');</script>"; } else{ 	$strPostMessage = $arrMessageId[0]->post_message; } $path = dirname(__FILE__); $path = str_replace("\\","/",$path); $path = trailingslashit(get_bloginfo('wpurl')) . trailingslashit(substr($path,strpos($path,"wp-content/")));//Get Plugin URL $url  = $path; $output = "<form method='post'> 				<table>	 				<tr>	 					<td>	 						<b>Message you want to show to inactive user after login:</b>	 					</td>	 					<td>	 						<textarea cols=55 rows=5 id='strPostMessage' name='strPostMessage'></textarea>	 					</td>	 					<td>	 						<input type='submit' name='btnSubmitMsg' id='btnSubmitMsg' class='button-primary' value='Save'/>	 					</td>	 					<td>	 						<p style='word-break:break-all;margin-left:10px;'><b><u>Current Message Displayed is:</u></b> ".$strPostMessage."</p>	 					</td>	 				</tr> 				</table> 			</form>"; $output.="<hr/>"; $output.="<form method='post'> 			<b>Search by Name and Email</b> <input type='text' id='strUserSearch' name='strUserSearch' style='width: 200px;' value='".$_POST['strUserSearch']."'/> 			<input type='submit' id='btnUserSearch' name='btnUserSearch' value='Search' class='button-primary' /> 		</form> 		<br/>"; $output.="<form method='post' onsubmit='return operation_ids()'>"; $output.= "<table class='widefat'>"; $output.="	<thead>				<tr>					<th><input type='checkbox' value='' id='chk_all_head' name='chk_all_head' onclick='get_head_val(this.value)' /></th>					<th>Name</th>					<th>Email</th>      					<th>Registered Date</th>					<th>Status</th>					<th>From Date</th>					<th>To Date</th>				</tr>			</thead>			<tfoot>				<tr>					<th><input type='checkbox' value='' id='chk_all_foot' name='chk_all_foot' onclick='get_foot_val(this.value)' /></th>					<th>Name</th>					<th>Email</th>					<th>Registered Date</th>					<th>Status</th>					<th>From Date</th>					<th>To Date</th>				</tr>			</tfoot>";if($intUserCount > 0){ foreach($arrUserDetails as $key=>$users){  $user_array = $wpdb->get_row('select status,status_from,status_to from '.$table.' where user_id='.$users->ID);		$output.="<tr>";			$output.="<td><input type='checkbox' id='chk_user[]' name='chk_user[]' style='margin:1px 0 0 8px;' onclick='hide_select_all()' value='".$users->ID."' /></td>";			$output.="<td>".ucwords($users->display_name)."</td>";			$output.="<td>".$users->user_email."</td>";			$output.="<td>".$users->user_registered."</td>";			$output.="<td><select id='set_user_status_".$key."'>";			if($user_array->status==0){				$output.="<option value='0' selected='selected'>Active</option>";				$output.="<option value='1'>Inactive</option>";			}else{				$output.="<option value='0'>Active</option>";				$output.="<option value='1' selected='selected'>Inactive</option>";			}			$output.="</select></td>";			$output.="<td><input type='text' id='txt_from_date_".$key."' name='txt_from_date[]' value='".$user_array->status_from."' class='from_date'></td>";			$output.="<td><input type='text' id='txt_to_date_".$key."' name='txt_to_date[]' value='".$user_array->status_to."' class='to_date'></td>";		$output.="</tr>"; }}else{	$output.="<tr>				<td colspan='6' align='center'><b>No User(s) Found</b></td>	         </tr>";} $output.="</table>"; $output.="<input type='hidden' value='".$url."' id='site_url' />"; $output.="<input type='hidden' value='' name='hidden_operation' id='hidden_operation' />"; $output.="<input type='submit' class='button-primary' name='save_selected' id='save_selected' value='Save' style='margin:5px 5px 0 0;' onclick=jQuery('#hidden_operation').val('save') />"; $output.="</form>";   // grab the current query parameters /*$query_string = $_SERVER['QUERY_STRING']; // The $base variable stores the complete URL to our page, including the current page arg // if in the admin, your base should be the admin URL + your page $base = admin_url('admin.php?page=USM/start.php') . '&' . remove_query_arg('p', $query_string) . '%_%';  $output.= paginate_links( array(    'base' => $base, // the base URL, including query arg    'format' => '&p=%#%', // this defines the query parameter that will be used, in this case "p"    'prev_text' => __('&laquo; Previous'), // text for previous page    'next_text' => __('Next &raquo;'), // text for next page    'total' => $total_pages, // the total number of pages we have    'current' => $page, // the current page    'end_size' => 1,    'mid_size' => 5, ));*/ echo $output;  function fnSetArgument($intOffset = 0) { 	$strSearch = $_POST['strUserSearch']; 	 if($_POST['strUserSearch']){		$args = array(			'search'         => "*".$strSearch."*",			'search_columns' => array( 'user_login', 'user_email' ),			'orderby' => 'registered',			'order' => 'DESC',			'offset' =>	$intOffset				);	 }	 else{	 	$args = array(			'orderby' => 'registered',			'order' => 'DESC',			'offset' => $intOffset		);	 }	 return $args; }?>